
function __ebcd {
    if [[ $1 != '' ]] ; then
        _e_to_pwd=$1
    else
        _e_to_pwd=$_e_old_pwd
    fi

    export _e_old_pwd=$(pwd)
    cd $_e_to_pwd
}

function __emkcd {
    mkdir $1 && __ebcd $1
}

function hr {
    _e_i=$(tput cols)
    while (( $((_e_i--)) > 0 )) ; do
        echo -n '-'
    done
}

function create_prompt {

    gitpart=""

#	if [[ ! "$PWD/" =~ /bs-tags/src ]]; then

	    if git ls-files ./ --error-unmatch >/dev/null 2>/dev/null ; then

		stash=$(git stash list | wc -l)
		git_status_short=$(git status -s --porcelain)
		stmod=$(echo -e "$git_status_short" | egrep -v "^\?\?"| grep -e "^M"|wc -l)
		mod=$(echo -e "$git_status_short" | egrep -v "^\?\?"| grep -e "^.M"|wc -l)
		add=$(echo -e "$git_status_short" | egrep -v "^\?\?"| grep -e "^A"|wc -l)
		stdel=$(echo -e "$git_status_short" | egrep -v "^\?\?"| grep -e "^D"|wc -l)
		del=$(echo -e "$git_status_short" | egrep -v "^\?\?"| grep -e "^.D"|wc -l)
		unt=$(echo -e "$git_status_short" | egrep "^\?\?" |wc -l)
		remote=$(git remote -v)
		git_status=$(git status | grep -e "^# Your branch is")
		local_branch=$(git branch | grep -e "^\*"| cut -d' ' -f2-)

		if echo $git_status | grep 'ahead' > /dev/null ; then

			remote_name=$(echo $git_status | sed -n "s~.*'\(\S\+\)/\S\+'\s.*~\1~p")
			remote_branch=$(echo $git_status | sed -n "s~.*'\S\+/\(\S\+\)'\s.*~\1~p")
			num=$(echo $git_status | sed -n "s~.*'\S\+'\sby\s\([0-9]\+\)\scommit.*~\1~p")
			remote_full_name=$(echo $remote | grep $remote_name | grep "(push)" | awk '{print $2}')
			rstat="${AZURE}$local_branch${HYELOW}-${HRED}$num${HYELOW}->${AZURE}$remote_full_name~$remote_branch$GREEN"

		elif echo $git_status | grep 'behind' > /dev/null ; then

                        remote_name=$(echo $git_status | sed -n "s~.*'\(\S\+\)/\S\+'\s.*~\1~p")
                        remote_branch=$(echo $git_status | sed -n "s~.*'\S\+/\(\S\+\)'\s.*~\1~p")
                        num=$(echo $git_status | sed -n "s~.*'\S\+'\sby\s\([0-9]\+\)\scommit.*~\1~p")
                        remote_full_name=$(echo $remote | grep $remote_name | grep "(fetch)" | awk '{print $2}')
                        rstat="${AZURE}$local_branch${HYELOW}<-${HRED}$num${HYELOW}-${AZURE}$remote_full_name~$remote_branch$GREEN"

		else

		    	rstat="$AZURE$branch$GREEN"

		fi

		if [ $mod -gt 0 ] ; then 
		    mod="$RED$mod$GREEN"
		else
		    mod="$NOC$mod$GREEN"
		fi

		if [ $stmod -gt 0 ] ; then
                    mod="$mod/$HRED$stmod$GREEN"
                fi

		if [ $add -gt 0 ] ; then 
		    add="$HRED$add$GREEN"
		else
		    add="$NOC$add$DARK$GREEN"
		fi

		if [ $del -gt 0 ] ; then 
		    del="$RED$del$GREEN"
		else
		    del="$NOC$del$GREEN"
		fi

                if [ $stdel -gt 0 ] ; then
                    del="$del/$HRED$stdel$GREEN"
                fi

                if [ $unt -gt 0 ] ; then
                    unt="$RED$unt$GREEN"
                else
                    unt="$NOC$unt$GREEN"
                fi

		if [ $stash -gt 0 ] ; then 
		    stash=" ${GREEN}S: $RED$stash$GREEN"
		else
		    stash=""
		fi

		gitpart="\n$GREEN(M: $mod A: $add D: $del U: $unt$stash$GREEN | $rstat)"

#	    fi
    fi

    if [[ "$USER" != "root" ]] ; then 
	    COLORPS=$HRED
    else
	    COLORPS=$GREEN
    fi

    SMAJL="\`if [ \$? = 0 ]; then echo -e '$GREEN:)'; else echo -e '$RED:('; fi\`"
    PS1="$COLORPS\u@\h:$HBLUE\w$gitpart$COLORPS\$ $SMAJL$NOC "

}

function git-prompt-disable {
    export PROMPT_COMMAND=""
}

function git-prompt-enable {
    export PROMPT_COMMAND="create_prompt"
}
